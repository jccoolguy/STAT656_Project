---
title: "Logistic Regression"
author: "Jack"
date: "2025-04-03"
output: html_document
---

# Loading Packages and Data

```{r loadingPackages}
require(dplyr)
require(caret)
require(pROC)
require(corrplot)
```

Adding non-transformed data:

```{r}
load("numeric_features_retained_no_yeoJ.Rdata")
load("factor_features_retained.Rdata")
```

Since logistic regression will suffer when predictors are highly correlated, we check the correlation plot for numeric variables.

# Correlation Filtering

```{r}
NumericVariablesCorr = cor(numeric_features_retained_no_yeoJ)
corrplot(NumericVariablesCorr, order = "hclust",tl.cex = .7)
```

There is a large pocket of correlation, mainly relating to the size of the loan amount.

Since there is evidence of high correlation between features, I decided to go with a correlation filter.

```{r}
highCorr = findCorrelation(NumericVariablesCorr, .8, verbose = TRUE, names = TRUE)
```

```{r}
highCorr = findCorrelation(NumericVariablesCorr, .8, names = TRUE)
```

Filtering out highly correlated features.

```{r}
numeric_features = numeric_features_retained_no_yeoJ[,!colnames(numeric_features_retained_no_yeoJ) %in% highCorr]
```

# Qualitative Feature Analysis and Data Splitting

Creating Dummy Variables:

```{r}
dummyModel = dummyVars(~ ., data = factor_features_retained, fullRank = TRUE)

factor_dummy = predict(dummyModel, factor_features_retained)

trainingDataIndex = createDataPartition(factor_features_retained$nocreditrequirement, p = .5, list = FALSE)
```

Combining Data:

```{r}
loan_data = cbind(numeric_features, factor_dummy)
```

Investigating no credit requirement:

```{r}
loan_data |>  group_by(nocreditrequirement) |> summarise(n())
```

I decided to stratify based on no credit requirement, as there are only 2749 instances where it is not required.

Creating training/test split

```{r}
Y = loan_data$loan_status
set.seed(10)
trainingDataIndex = createDataPartition(loan_data$nocreditrequirement, p = .5,
                                        list = FALSE)
trainingData = loan_data[trainingDataIndex,]
testingData  = loan_data[-trainingDataIndex,]
```

# Supervisor

```{r}
Ytrain = factor(select(trainingData, loan_status) |> unlist(), 
                labels = c('Fully Paid', 'Charged Off'))
Ytest   = factor(select(testingData, loan_status) |> unlist(), 
                labels = c('Fully Paid', 'Charged Off'))
```
